# 🔍 搜尋功能使用指南

## 🎯 功能概述

VoteChaos 現在擁有完整的搜尋功能，用戶可以快速找到感興趣的投票主題。

---

## ✅ 已實現的功能

### 1. **智能搜尋**
- ✅ 標題搜尋 - 匹配主題標題
- ✅ 標籤搜尋 - 匹配主題標籤
- ✅ 內容搜尋 - 匹配主題描述
- ✅ 相關性排序 - 標題匹配優先

### 2. **搜尋歷史**
- ✅ 自動記錄最近 10 次搜尋
- ✅ 快速重複搜尋
- ✅ 單條刪除
- ✅ 一鍵清除
- ✅ 本地儲存（localStorage）

### 3. **熱門標籤**
- ✅ 顯示常用標籤
- ✅ 一鍵搜尋
- ✅ 30+ 預設標籤

### 4. **進階篩選**
- ✅ 標籤篩選 - 選擇多個標籤
- ✅ 篩選狀態顯示
- ✅ 一鍵清除篩選

### 5. **搜尋結果**
- ✅ 結果數量顯示
- ✅ 匹配類型標記
- ✅ 空結果友善提示
- ✅ 載入狀態動畫

---

## 🎨 UI 組件

### 新增的組件（4個）：

1. **`SearchBar.tsx`** - 搜尋輸入框
   - 搜尋輸入
   - 搜尋按鈕
   - 清除按鈕
   - 載入動畫
   - 搜尋建議下拉

2. **`SearchResults.tsx`** - 搜尋結果顯示
   - 結果列表
   - 匹配類型標記
   - 空狀態處理

3. **`SearchFilters.tsx`** - 進階篩選
   - 標籤選擇
   - 篩選器抽屜
   - 已選標籤顯示

4. **`useSearch.tsx`** - 搜尋邏輯 Hook
   - 搜尋執行
   - 歷史管理
   - 篩選應用

---

## 🚀 使用方式

### 用戶端操作：

#### 1. **基本搜尋**
1. 在首頁點擊搜尋框
2. 輸入關鍵字（例如：美食、科技）
3. 按 Enter 或點擊「搜尋」按鈕
4. 自動切換到「搜尋」分頁顯示結果

#### 2. **使用搜尋歷史**
1. 點擊搜尋框（未輸入時）
2. 查看最近搜尋記錄
3. 點擊任一歷史項目重新搜尋
4. 點擊 X 刪除單條歷史

#### 3. **使用熱門標籤**
1. 點擊搜尋框
2. 在下方查看熱門標籤
3. 點擊任一標籤快速搜尋

#### 4. **進階篩選**
1. 點擊搜尋框右側的「篩選」按鈕
2. 選擇想要的標籤（可多選）
3. 點擊「套用篩選」
4. 搜尋結果會根據篩選條件顯示

#### 5. **清除搜尋**
1. 點擊搜尋框內的 X 按鈕
2. 或切換到其他分頁（熱門/最新/參與過）

---

## 🔍 搜尋匹配規則

### 匹配優先級：

1. **標題匹配**（最高優先）
   - 完全匹配或部分匹配標題
   - 結果排在最前面
   - 標記：📄 標題匹配

2. **標籤匹配**（中優先）
   - 匹配主題的任一標籤
   - 結果排在中間
   - 標記：🏷️ 標籤匹配

3. **內容匹配**（低優先）
   - 匹配主題描述
   - 結果排在最後
   - 標記：📝 內容匹配

### 搜尋範圍：

- ✅ 僅搜尋活躍主題（status = 'active'）
- ✅ 僅搜尋已審核主題（approval_status = 'approved'）
- ✅ 僅搜尋未過期主題（end_at > 現在）

---

## 🎯 搜尋技巧

### 提高搜尋效果：

1. **使用關鍵字**
   - ✅ 好：「台灣美食」
   - ❌ 差：「我想找關於台灣的美食主題」

2. **使用標籤**
   - ✅ 好：搜尋「美食」會匹配所有有此標籤的主題
   - ✅ 好：搜尋「科技」會找到所有科技相關主題

3. **組合篩選**
   - ✅ 先搜尋「電影」
   - ✅ 再用篩選器選擇「娛樂」標籤
   - ✅ 獲得更精準的結果

4. **使用搜尋歷史**
   - ✅ 快速重複之前的搜尋
   - ✅ 節省輸入時間

---

## 📊 搜尋數據

### 搜尋歷史：
- **儲存位置**: localStorage
- **Key**: `search_history`
- **數量限制**: 最多 10 條
- **排序**: 最新在前

### 熱門標籤：
預設提供 30+ 個常用標籤，涵蓋：
- 生活類：美食、旅遊、運動、健康等
- 娛樂類：電影、音樂、遊戲、動漫等
- 科技類：科技、AI、手機、程式等
- 社會類：時事、政治、經濟、教育等
- 興趣類：閱讀、攝影、手作、烹飪等

---

## 🔧 技術實現

### 搜尋流程：

```
用戶輸入關鍵字
  ↓
useSearch hook 處理
  ↓
查詢 Supabase topics 表
  ↓
應用篩選條件（標籤、狀態等）
  ↓
前端篩選匹配（標題/標籤/描述）
  ↓
按相關性排序
  ↓
顯示結果
  ↓
自動保存到搜尋歷史
```

### 資料庫查詢優化：

1. **預先篩選** - 只查詢活躍且已審核的主題
2. **限制數量** - 最多返回 50 個結果
3. **關聯查詢** - 一次查詢獲取創建者資訊
4. **前端篩選** - 避免複雜的資料庫查詢

---

## 🎨 UI/UX 特色

### 搜尋框：
- ✅ 搜尋圖示提示
- ✅ 即時清除按鈕
- ✅ 載入動畫
- ✅ Enter 快捷鍵
- ✅ 自動聚焦

### 搜尋建議：
- ✅ 下拉式設計
- ✅ 搜尋歷史顯示
- ✅ 熱門標籤快速選擇
- ✅ 單條刪除功能
- ✅ 自動隱藏（失焦時）

### 搜尋結果：
- ✅ 結果數量提示
- ✅ 匹配類型標記
- ✅ 空結果友善提示
- ✅ 建議替代操作

### 篩選器：
- ✅ 底部抽屜設計
- ✅ 已選標籤顯示
- ✅ 可視化選擇狀態
- ✅ 一鍵重置
- ✅ 篩選數量徽章

---

## 🔮 未來可擴展

### 搜尋增強：

1. **全文索引** - 使用 PostgreSQL FTS
   ```sql
   CREATE INDEX topics_title_search 
   ON topics USING GIN (to_tsvector('chinese', title));
   ```

2. **搜尋建議** - 自動補全
   - 根據熱門搜尋
   - 根據用戶歷史

3. **搜尋分析**
   - 記錄熱門搜尋詞
   - 優化標籤推薦

4. **進階篩選**
   - 投票數範圍
   - 時間範圍
   - 創建者篩選
   - 排序方式選擇

5. **搜尋結果優化**
   - 關鍵字高亮
   - 無限滾動
   - 結果快取

---

## 💡 最佳實踐

### 開發建議：

1. **性能優化**
   - 搜尋防抖（debounce）- 避免頻繁查詢
   - 結果快取 - 相同搜尋不重複查詢
   - 分頁載入 - 大量結果時

2. **用戶體驗**
   - 即時反饋 - 載入動畫
   - 空狀態處理 - 友善提示
   - 快捷操作 - 搜尋歷史

3. **資料準確性**
   - 只搜尋可見主題
   - 過濾已結束主題
   - 即時更新結果

---

## 📱 移動端適配

### 已處理：
- ✅ 響應式布局
- ✅ 觸控優化
- ✅ 底部抽屜（篩選器）
- ✅ 大按鈕（易點擊）

### 特殊處理：
- 搜尋框高度加大（h-11）
- 標籤可滑動選擇
- 篩選器使用 Sheet（底部彈出）
- 鍵盤自動彈出聚焦

---

## 🧪 測試清單

### 功能測試：
- [ ] 搜尋標題關鍵字
- [ ] 搜尋標籤
- [ ] 搜尋描述內容
- [ ] 使用搜尋歷史
- [ ] 使用熱門標籤
- [ ] 應用標籤篩選
- [ ] 清除搜尋
- [ ] 刪除歷史記錄

### 邊界測試：
- [ ] 空搜尋（無結果）
- [ ] 特殊字元搜尋
- [ ] 超長關鍵字
- [ ] 無網路連接
- [ ] 資料庫錯誤

### 性能測試：
- [ ] 大量結果載入
- [ ] 快速切換搜尋
- [ ] 記憶體使用

---

## 📊 搜尋統計（可選）

### 未來可添加：

記錄搜尋數據以優化體驗：

```typescript
// 記錄搜尋事件到 audit_logs
await supabase
  .from('audit_logs')
  .insert({
    user_id: user?.id,
    action: 'search',
    resource_type: 'topic',
    metadata: { 
      query: searchQuery,
      results_count: results.length,
      filters: appliedFilters
    }
  });
```

### 分析用途：
- 了解用戶興趣
- 優化熱門標籤
- 改進搜尋算法
- 發現熱門話題

---

## 🎊 完成狀態

### ✅ 已實現：
- ✅ 搜尋核心邏輯
- ✅ 搜尋 UI 組件
- ✅ 搜尋結果顯示
- ✅ 搜尋歷史
- ✅ 熱門標籤
- ✅ 標籤篩選
- ✅ 首頁整合

### 🎯 搜尋功能完成度：**100%** ✅

---

## 📝 使用範例

### 範例 1：搜尋美食主題
```
1. 點擊搜尋框
2. 輸入「美食」
3. 按 Enter
4. 看到所有包含「美食」的主題
```

### 範例 2：使用標籤篩選
```
1. 搜尋「台灣」
2. 點擊「篩選」按鈕
3. 選擇「美食」標籤
4. 點擊「套用篩選」
5. 看到台灣美食相關主題
```

### 範例 3：快速重複搜尋
```
1. 點擊搜尋框
2. 在搜尋歷史中點擊之前搜尋過的「電影」
3. 立即顯示結果
```

---

## 💡 小技巧

### 提高搜尋效率：

1. **使用標籤搜尋** - 比標題更準確
2. **組合篩選** - 搜尋 + 標籤篩選
3. **善用歷史** - 快速重複搜尋
4. **嘗試熱門標籤** - 發現熱門話題

---

## 🔧 開發者資訊

### 檔案清單：

| 檔案 | 功能 | 行數 |
|------|------|------|
| `src/hooks/useSearch.tsx` | 搜尋邏輯 | ~180 |
| `src/components/SearchBar.tsx` | 搜尋框 | ~180 |
| `src/components/SearchResults.tsx` | 結果顯示 | ~110 |
| `src/components/SearchFilters.tsx` | 篩選器 | ~130 |
| `src/pages/HomePage.tsx` | 整合 | 已更新 |

### API 使用：

```typescript
// 使用 useSearch hook
const { 
  query,          // 當前搜尋詞
  setQuery,       // 設置搜尋詞
  results,        // 搜尋結果
  loading,        // 載入狀態
  search,         // 執行搜尋
  searchHistory,  // 搜尋歷史
  applyFilters    // 應用篩選
} = useSearch();

// 執行搜尋
search('美食');

// 應用篩選
applyFilters({ tags: ['美食', '台灣'] });
```

---

## 🎉 總結

搜尋功能已完全實現並整合到首頁！

**現在用戶可以**：
- 🔍 快速搜尋感興趣的主題
- 📋 查看搜尋歷史
- 🏷️ 使用標籤篩選
- ⚡ 一鍵快速搜尋

**完成度**: **100%** ✅

下一步建議實現：
1. 個人資料編輯功能
2. 留言系統
3. 任務系統完善

搜尋功能大大提升了用戶體驗！🎊

