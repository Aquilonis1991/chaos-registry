# 原生廣告實作計劃（AdMob Native Ad Integration）

## 目標
同時在 **Android 與 iOS** 使用 Google AdMob 原生廣告（Native Ad），讓廣告卡片外觀與現有主題卡片一致，並可透過 `system_config` 控制 Ad Unit 切換測試 / 正式環境。

---

## 實作階段

### 1. 前端介面與 UI 改造
1. 定義 `NativeAdData` 介面（標題、描述、CTA、主圖、影片、廣告主、星等等）。
2. 改寫 `NativeAdCard`，以 `NativeAdData` 內容渲染，而非固定 placeholder。
3. 保留 loading / error / fallback UI，確保尚未載入或失敗時仍可顯示占位。

### 2. 建立 Capacitor Plugin 骨架
1. 新增 `native-ad-plugin`（暫名），提供 `loadNativeAd({ adUnitId })` API。
2. Plugin 需回傳 `NativeAdData` 或錯誤資訊（以 Promise 形式）。
3. 確保 Android / iOS 專案都能編譯通過，先完成 Plugin 註冊與基本串接。

### 3. Android 原生整合
1. 匯入 Google Mobile Ads SDK（Gradle）。
2. 使用 `AdLoader` + `NativeAdOptions` 載入廣告：
   - 在 `onNativeAdLoaded` 將資料轉為 `NativeAdData`。
   - 在 `onAdFailedToLoad` 回傳錯誤。
3. 支援測試 ID（`ca-app-pub-3940256099942544/2247696110`）與正式 ID 切換。
4. 以 logcat 檢查載入結果並確保沒有記憶體洩漏（NativeAdView 要適時 destroy）。

### 4. iOS 原生整合
1. Podfile 加入 `Google-Mobile-Ads-SDK`。
2. 使用 `GADAdLoader` + `GADNativeAdLoaderDelegate`：
   - 在 `adLoader(_:didReceive:)` 取得 `GADNativeAd`，轉為 `NativeAdData`。
   - 在 `adLoader(_:didFailToReceiveAdWithError:)` 回傳錯誤。
3. 處理 `GADMediaContent`（圖片 / 影片）與測試裝置設定。
4. 以 Xcode log 驗證載入流程。

### 5. React 端串接
1. 在 `NativeAdCard` 掛載時呼叫 `NativeAdPlugin.loadNativeAd` 並監聽結果。
2. 成功：更新 state 顯示真實素材；失敗：顯示 fallback 或重試按鈕。
3. 考慮多卡片載入與列表滾動（避免重複請求或資料錯位）。

### 6. 設定與文件
1. 在 `system_config` 中管理：
   - `admob_native_ad_unit_id`（測試/正式 ID）
   - `ad_insertion_enabled`、`ad_insertion_interval`、`ad_insertion_skip_first`
2. 更新 Android `AndroidManifest.xml` 的 `APPLICATION_ID` 以及 iOS Info.plist 設置。
3. 撰寫 QA / 驗證清單：
   - 變更 `system_config` → App 重新開啟即可套用。
   - 使用測試 ID 測試載入 → 改成正式 ID 後再次驗證。
   - 檢查 `Ad` 標示是否符合政策。

---

## 待確認事項
- 正式 Ad Unit ID、App ID 由誰提供 & 何時切換。
- 是否需要支援多種 Native 版型（例如小卡 / 大卡），或先以單一版型為主。
- 是否要在載入失敗時自動 fallback 一張自家宣傳卡（需再討論）。

---

## 接下來的行動
1. **完成前端介面與 `NativeAdCard` 改造**（Step 1）。
2. **建立 Plugin 雛形並可在兩平台編譯**（Step 2）。✅ 已完成：`native-ad-plugin/`
3. **Android / iOS / React 串接實作**（Step 3~5）✅ 第一版已提交，待後續實機驗證。
4. 更新設定與 QA 文件（Step 6）— 持續同步此文件並補充測試結果。

執行過程若需要調整，會即時更新此文件並與你確認。

