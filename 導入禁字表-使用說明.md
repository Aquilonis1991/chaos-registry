# 📋 禁字表系統導入說明

## 🎯 功能概述

禁字表系統用於檢查和過濾以下內容：
- ✅ 主題標題
- ✅ 主題描述
- ✅ 投票選項
- ✅ 主題標籤
- ✅ 主題分類
- ✅ 會員名稱

## 📝 使用步驟

### 步驟 1：創建資料庫結構

在 Supabase SQL Editor 執行：

```sql
-- 執行 創建禁字表系統.sql
```

這會創建：
- `banned_words` 表
- `check_banned_words()` 函數
- `validate_topic_content()` 函數
- `validate_nickname()` 函數
- `import_banned_words_from_csv()` 函數

### 步驟 2：導入禁字表數據

#### 方法 A：使用 Python 腳本（推薦）

1. 安裝 Python（如果還沒有）
2. 執行腳本：
```bash
python 轉換CSV為SQL腳本.py
```

3. 會生成兩個文件：
   - `導入禁字表數據.sql` - 直接執行的 SQL
   - `禁字表數據.json` - JSON 格式
   - `禁字表數據_import.sql` - 使用函數導入的 SQL

4. 在 Supabase SQL Editor 執行 `導入禁字表數據.sql`

#### 方法 B：使用管理界面導入

1. 訪問後台管理頁面 (`/admin`)
2. 切換到「禁字表」標籤
3. 點擊「導入 CSV」按鈕
4. 貼上 CSV 內容或上傳文件

#### 方法 C：手動導入（小量數據）

1. 訪問後台管理頁面 (`/admin`)
2. 切換到「禁字表」標籤
3. 點擊「新增禁字」按鈕
4. 逐個添加禁字

## 🔍 驗證功能

### 前端驗證

系統已自動在以下位置加入驗證：
- ✅ 創建主題時（`CreateTopicPage.tsx`）
- ✅ 編輯主題時（`EditTopicDialog.tsx`）
- ✅ 更新用戶名稱時（`ProfilePage.tsx`）

### 後端驗證

資料庫函數會自動驗證：
- `validate_topic_content()` - 驗證主題內容
- `validate_nickname()` - 驗證用戶名稱

## 📊 禁字級別說明

- **A 級**：最嚴重，直接阻擋（block）
- **B 級**：遮罩處理（mask）
- **C 級**：需要審核（review）
- **D 級**：需要審核（review）
- **E 級**：需要審核（review）
- **F 級**：最低，需要審核（review）

## 🛠️ 管理界面功能

在 `/admin` 頁面的「禁字表」標籤可以：

- ✅ 查看所有禁字
- ✅ 搜尋禁字（關鍵字、分類）
- ✅ 按級別篩選
- ✅ 按處理方式篩選
- ✅ 新增禁字
- ✅ 編輯禁字
- ✅ 刪除禁字
- ✅ 啟用/停用禁字
- ✅ 導入 CSV

## ⚠️ 注意事項

1. **編碼問題**：CSV 文件可能使用 Big5 編碼，Python 腳本會自動嘗試多種編碼
2. **重複數據**：使用 `ON CONFLICT` 處理重複關鍵字
3. **效能考量**：禁字表使用索引優化，查詢速度較快
4. **錯誤處理**：如果驗證函數出錯，不會阻擋用戶操作（避免系統故障影響用戶）

## 🔄 更新禁字表

### 即時更新

1. 在管理界面修改禁字
2. 修改立即生效，無需重啟服務

### 批量更新

1. 準備新的 CSV 文件
2. 使用管理界面導入
3. 系統會自動處理重複和更新

## 📝 CSV 格式

```csv
level,category,keyword,action
A,性別/色/不當,關鍵字1,block
B,政治/政治敏感,關鍵字2,mask
C,暴力/血腥內容,關鍵字3,review
```

## ✅ 驗證測試

創建主題時，如果包含禁字：
- **block**：直接阻止，顯示錯誤訊息
- **mask**：顯示警告，但允許提交（會被遮罩）
- **review**：顯示警告，允許提交但需要審核

更新用戶名稱時，如果包含禁字：
- **block**：直接阻止
- **mask/review**：允許但會有提示

---

**系統已準備就緒！** 🎉

