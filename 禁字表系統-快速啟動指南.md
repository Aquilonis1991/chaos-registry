# 🚀 禁字表系統 - 快速啟動指南

## ✅ 步驟 1：執行 SQL 腳本（已完成）

已在 Supabase SQL Editor 執行 `創建禁字表系統.sql`

## 📝 步驟 2：導入禁字表數據

### 方法 A：使用 Python 腳本（推薦）

1. **執行 Python 腳本**
```bash
python 轉換CSV為SQL腳本.py
```

2. **會生成以下文件：**
   - `導入禁字表數據.sql` - 直接執行的 SQL
   - `禁字表數據.json` - JSON 格式數據
   - `禁字表數據_import.sql` - 使用函數導入的 SQL

3. **在 Supabase SQL Editor 執行生成的 SQL：**
   - 打開 `導入禁字表數據.sql`
   - 複製內容到 Supabase SQL Editor
   - 點擊執行

### 方法 B：使用管理界面導入（更簡單）

1. **啟動開發伺服器**
```bash
npm run dev
```

2. **訪問後台管理頁面**
   - 登入管理員帳號
   - 訪問：`http://localhost:8080/admin`
   - 切換到「禁字表」標籤

3. **導入 CSV**
   - 點擊「導入 CSV」按鈕
   - 打開 `VoteChaos_BannedWords_V5.csv` 文件
   - 複製全部內容（Ctrl+A, Ctrl+C）
   - 貼到對話框中
   - 點擊確認

4. **查看結果**
   - 應該會顯示「成功導入 XXX 條記錄」
   - 表格中會顯示所有禁字

## ✅ 步驟 3：驗證系統是否正常

### 3.1 檢查資料庫

在 Supabase SQL Editor 執行：

```sql
-- 檢查禁字表是否創建成功
SELECT COUNT(*) as total_words FROM public.banned_words;

-- 查看前 10 條記錄
SELECT level, keyword, action, is_active 
FROM public.banned_words 
ORDER BY level, keyword 
LIMIT 10;

-- 檢查函數是否存在
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_schema = 'public' 
  AND routine_name IN ('check_banned_words', 'validate_topic_content', 'validate_nickname');
```

### 3.2 測試前端驗證

1. **測試創建主題**
   - 訪問：`http://localhost:8080/create-topic`
   - 嘗試在標題中輸入禁字（例如：某些 A 級禁字）
   - 應該會顯示錯誤訊息並阻止提交

2. **測試更新用戶名稱**
   - 訪問：`http://localhost:8080/profile`
   - 嘗試編輯名稱，輸入禁字
   - 應該會顯示錯誤訊息

3. **測試管理界面**
   - 訪問：`http://localhost:8080/admin`
   - 切換到「禁字表」標籤
   - 應該能看到所有禁字列表
   - 測試搜尋、篩選功能

## 🔧 步驟 4：配置管理員帳號（如果需要）

如果還沒有管理員帳號，需要先創建：

```sql
-- 將你的用戶 ID 設為管理員
-- 1. 先找到你的用戶 ID
SELECT id, email FROM auth.users;

-- 2. 將用戶 ID 插入 admin_users 表
INSERT INTO public.admin_users (user_id)
VALUES ('你的用戶ID'::uuid)
ON CONFLICT (user_id) DO NOTHING;
```

或者使用 Supabase Dashboard：
1. 進入 Authentication → Users
2. 找到你的帳號，複製 User UUID
3. 在 SQL Editor 執行上面的 INSERT 語句

## 📊 步驟 5：驗證功能清單

- [ ] 禁字表數據已導入（檢查記錄數）
- [ ] 創建主題時能檢測禁字（測試標題）
- [ ] 編輯主題時能檢測禁字（測試編輯）
- [ ] 更新用戶名稱時能檢測禁字（測試名稱）
- [ ] 管理界面能正常顯示禁字列表
- [ ] 管理界面能搜尋和篩選禁字
- [ ] 管理界面能新增/編輯/刪除禁字
- [ ] 管理界面能導入 CSV

## 🎯 步驟 6：測試不同級別的禁字

### A 級（block - 直接阻擋）
- 測試：創建主題時在標題中使用 A 級禁字
- 預期：顯示錯誤，無法提交

### B/C/D/E/F 級（mask/review）
- 測試：創建主題時使用這些級別的禁字
- 預期：顯示警告，但允許提交（可能需要審核）

## 📝 常見問題

### Q: 導入 CSV 後沒有數據？
**A:** 檢查：
1. CSV 編碼是否正確（可能需要使用 Big5）
2. Python 腳本是否成功執行
3. SQL 是否有錯誤訊息

### Q: 管理界面無法訪問？
**A:** 確認：
1. 你的帳號是否在 `admin_users` 表中
2. 是否已登入
3. 瀏覽器控制台是否有錯誤

### Q: 驗證功能不工作？
**A:** 檢查：
1. 前端是否正確導入 `bannedWords.ts`
2. 資料庫函數是否正確創建
3. 瀏覽器控制台是否有錯誤

### Q: CSV 編碼問題？
**A:** Python 腳本會自動嘗試 UTF-8 和 Big5 編碼，如果還有問題：
- 使用 Excel 或記事本打開 CSV
- 另存為 UTF-8 編碼
- 重新執行 Python 腳本

## 🎉 完成！

系統已準備就緒，可以開始使用禁字表功能了！

---

**提示：** 如果遇到任何問題，檢查：
1. Supabase Dashboard 的 Logs 是否有錯誤
2. 瀏覽器開發者工具的 Console 和 Network 標籤
3. 資料庫函數是否正確執行

