# 網頁版管理員限制設定說明

## 功能概述

已實作「非管理者帳號無法使用網頁版本」的限制功能。此功能確保：
- **原生 App（iOS/Android）**：所有用戶（包括匿名用戶）可正常使用
- **網頁版**：
  - ✅ 匿名用戶：可正常使用
  - ✅ 已登入的管理員：可正常使用
  - ❌ 已登入的非管理員：顯示「僅限管理員使用」頁面

## 實作檔案

### 1. 新增頁面組件
- **`src/pages/WebAdminOnlyPage.tsx`**
  - 顯示「網頁版僅限管理員使用」的提示頁面
  - 使用 UI 文字管理系統，支援多語言

### 2. 更新入口頁面
- **`src/pages/Index.tsx`**
  - 在應用程式入口處檢查用戶權限
  - 網頁版非管理員用戶會直接顯示限制頁面

### 3. 更新路由保護
- **`src/components/ProtectedRoute.tsx`**
  - 在所有受保護的路由中加入管理員檢查
  - 確保非管理員無法透過直接輸入網址訪問任何頁面

### 4. UI 文字管理
- **`UI_texts_error_feedback.csv`**
  - 新增三個 UI 文字 key：
    - `webAdminOnly.title` - 標題
    - `webAdminOnly.description` - 描述
    - `webAdminOnly.message` - 提示訊息

## 運作邏輯

### 檢查流程

```
用戶訪問網頁版
    ↓
檢查是否為原生 App？
    ├─ 是 → 允許所有用戶使用
    └─ 否 → 繼續檢查
        ↓
    檢查用戶是否已登入？
        ├─ 否 → 允許使用（匿名模式）
        └─ 是 → 繼續檢查
            ↓
        檢查是否為管理員？
            ├─ 是 → 允許使用
            └─ 否 → 顯示「僅限管理員使用」頁面
```

### 保護點

1. **入口點保護** (`Index.tsx`)
   - 用戶首次進入應用程式時檢查
   - 非管理員直接顯示限制頁面

2. **路由保護** (`ProtectedRoute.tsx`)
   - 所有使用 `<ProtectedRoute>` 的路由都會檢查
   - 包括：`/home`, `/search`, `/vote/:id`, `/create`, `/profile` 等

## 測試建議

### 測試場景 1：網頁版非管理員登入
1. 在網頁瀏覽器開啟應用程式
2. 使用非管理員帳號登入
3. **預期結果**：顯示「網頁版僅限管理員使用」頁面

### 測試場景 2：網頁版管理員登入
1. 在網頁瀏覽器開啟應用程式
2. 使用管理員帳號登入
3. **預期結果**：正常進入首頁，可正常使用所有功能

### 測試場景 3：網頁版匿名使用
1. 在網頁瀏覽器開啟應用程式
2. 不登入，使用匿名模式
3. **預期結果**：可正常使用（匿名用戶不受限制）

### 測試場景 4：原生 App 非管理員登入
1. 在 iOS/Android App 中開啟應用程式
2. 使用非管理員帳號登入
3. **預期結果**：可正常使用所有功能（原生 App 不受限制）

### 測試場景 5：直接輸入網址
1. 在網頁版使用非管理員帳號登入後
2. 直接輸入網址（如 `/home`, `/profile` 等）
3. **預期結果**：仍會顯示「僅限管理員使用」頁面（路由保護生效）

## 技術細節

### 使用的 Hook
- `useAuth()` - 獲取用戶認證狀態
- `useAdmin()` - 檢查用戶是否為管理員
- `isNative()` - 檢查是否為原生 App 環境

### 檢查條件
```typescript
if (!isNative() && user && !isAdmin) {
  // 顯示限制頁面
}
```

條件說明：
- `!isNative()` - 必須是網頁版
- `user` - 必須已登入（非匿名）
- `!isAdmin` - 必須不是管理員

## 注意事項

1. **匿名用戶不受限制**：網頁版的匿名用戶可以正常使用，只有已登入的非管理員會被限制

2. **管理員權限檢查**：管理員權限是透過 `admin_users` 表檢查，確保該用戶的 `user_id` 存在於表中

3. **UI 文字管理**：所有提示文字都透過 UI 文字管理系統，可在後台修改，支援多語言

4. **編譯狀態**：專案已成功編譯，所有變更已生效

## 後續維護

如需修改限制邏輯或提示文字：
1. 修改 `src/pages/WebAdminOnlyPage.tsx` 調整頁面樣式
2. 修改 `UI_texts_error_feedback.csv` 調整提示文字
3. 修改 `src/pages/Index.tsx` 或 `src/components/ProtectedRoute.tsx` 調整檢查邏輯

---

**設定完成時間**：2025-01-27
**編譯狀態**：✅ 成功
**測試狀態**：待測試

