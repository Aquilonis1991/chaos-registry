# 🔍 診斷個人資料頁面問題

## 問題描述
無法連接到個人資料頁面 - 頁面一直顯示 loading 圖示

## 可能原因

### 1. Profile 記錄不存在
當用戶註冊時，應該自動建立 profile 記錄，但可能沒有成功建立。

### 2. 資料庫權限問題
RLS (Row Level Security) 政策可能阻止了查詢。

### 3. 環境變數未生效
還在連接到舊的資料庫專案。

---

## 🔍 診斷步驟

### 步驟 1：檢查 Console 錯誤

1. **F12 → Console 標籤**
2. **重新整理個人資料頁面**
3. **查看是否有錯誤訊息**

**常見錯誤**：
- `Error fetching profile:` - 查看詳細錯誤
- `PGRST116` - 表格不存在或 RLS 阻止
- `Failed to fetch` - 網路或 CORS 問題

### 步驟 2：檢查 Network 請求

1. **F12 → Network 標籤**
2. **重新整理頁面**
3. **查找 `profiles` 的請求**

**檢查項目**：
- URL 是否包含 `epyykzxxglkjombvozhr`？
- 狀態碼是什麼？（200, 404, 500？）
- Response 中有什麼錯誤訊息？

---

## 🛠️ 解決方案

### 方案 1：手動建立 Profile 記錄

如果 profile 不存在，在 Supabase SQL Editor 執行：

```sql
-- 查看當前用戶
SELECT id, email FROM auth.users ORDER BY created_at DESC LIMIT 5;

-- 為用戶建立 profile（替換 USER_ID 為實際的 UUID）
INSERT INTO public.profiles (id, nickname, avatar, tokens)
VALUES (
  'USER_ID_FROM_ABOVE',
  'User',
  '🔥',
  1000
)
ON CONFLICT (id) DO UPDATE SET
  tokens = 1000;
```

### 方案 2：重新觸發 Profile 建立

重新註冊一個新帳號，看是否能正常建立 profile。

### 方案 3：檢查並修復 RLS 政策

在 Supabase SQL Editor 執行：

```sql
-- 檢查現有政策
SELECT * FROM pg_policies WHERE tablename = 'profiles';

-- 確保 RLS 政策正確
DROP POLICY IF EXISTS "Users can view all profiles" ON public.profiles;
DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;
DROP POLICY IF EXISTS "Users can insert own profile" ON public.profiles;

CREATE POLICY "Users can view all profiles"
  ON public.profiles FOR SELECT
  USING (true);

CREATE POLICY "Users can update own profile"
  ON public.profiles FOR UPDATE
  USING (auth.uid() = id);

CREATE POLICY "Users can insert own profile"
  ON public.profiles FOR INSERT
  WITH CHECK (auth.uid() = id);
```

### 方案 4：重新初始化資料庫

如果以上都不行，重新執行 `00-完整資料庫架構.sql`。

---

## 📋 快速檢查清單

請依序檢查並告訴我結果：

1. **Console 中有什麼錯誤訊息？**
   - [ ] 有錯誤（請複製完整錯誤）
   - [ ] 沒有錯誤

2. **Network 中 profiles 請求的狀態？**
   - [ ] 200 OK（成功但資料為空？）
   - [ ] 404 Not Found
   - [ ] 500 Internal Server Error
   - [ ] 其他（請說明）

3. **URL 是否正確？**
   - [ ] 包含 `epyykzxxglkjombvozhr`
   - [ ] 包含 `idfqzcsxvuxperxfieam`（舊的）
   - [ ] 其他

4. **是否已登入？**
   - [ ] 是（可以看到用戶 email）
   - [ ] 否（未登入）

5. **Supabase Dashboard 中是否有 profile 記錄？**
   - [ ] 前往 Table Editor → profiles 查看
   - [ ] 有記錄
   - [ ] 沒有記錄

---

## 🎯 立即行動

請執行：

1. **打開** http://localhost:8080/profile
2. **F12 → Console 標籤**
3. **複製所有錯誤訊息**
4. **F12 → Network 標籤**
5. **找到 `profiles` 請求**
6. **點擊查看 Response**

然後告訴我：
- Console 顯示什麼錯誤？
- Network 中 profiles 請求的狀態碼？
- Response 的內容是什麼？

這樣我才能精確診斷問題！🔍


